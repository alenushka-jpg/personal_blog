const first=([e])=>e,computeValue=(e,t)=>"function"==typeof e?e(t):e,getElements=e=>Array.isArray(e)?e:!e||e.nodeType?[e]:Array.from("string"==typeof e?document.querySelectorAll(e):e),accelerate=({style:e},t)=>e.willChange=t?t.map((({property:e})=>e)).join():"auto",createSVG=(e,t)=>Object.entries(t).reduce(((e,[t,r])=>(e.setAttribute(t,r),e)),document.createElementNS("http://www.w3.org/2000/svg",e)),blurs={axes:["x","y"],count:0,add({element:e,blur:t}){const r="motion-blur-"+this.count++,a=createSVG("svg",{style:"position: absolute; width: 0; height: 0"}),n=createSVG("filter",this.axes.reduce(((e,r)=>{const a=2*t[r];return e[r]=`-${a}%`,e["x"==r?"width":"height"]=100+2*a+"%",e}),{id:r,"color-interpolation-filters":"sRGB"})),i=createSVG("feGaussianBlur",{in:"SourceGraphic"});return n.append(i),a.append(n),e.style.filter=`url("#${r}")`,document.body.prepend(a),i}},getDeviation=(e,{easing:t},r)=>{const a=e*r,n=e-a,i="linear"==t?e:t.startsWith("in-out")?2*(r<.5?a:n):t.startsWith("in")?a:n;return Math.max(0,i)},setDeviation=({blur:e,gaussian:t,easing:r},a)=>{const n=blurs.axes.map((t=>getDeviation(e[t],r,a)));t.setAttribute("stdDeviation",n.join())},normalizeBlur=e=>{const t=blurs.axes.reduce(((e,t)=>(e[t]=0,e)),{});return Object.assign(t,e)},clearBlur=({style:e},{parentNode:{parentNode:t}})=>{e.filter="none",t.remove()},hexPairs=e=>{const t=e.split(""),r=e.length<5?t.map((e=>e+e)):t.reduce(((e,r,a)=>(a%2&&e.push(t[a-1]+r),e)),[]);return r.length<4&&r.push("ff"),r},convert=e=>hexPairs(e).map((e=>parseInt(e,16))),rgba=e=>{const t=e.slice(1),[r,a,n,i]=convert(t);return`rgba(${r}, ${a}, ${n}, ${i/255})`},pi2=2*Math.PI,getOffset=(e,t)=>t/pi2*Math.asin(1/e),easings={linear:e=>e,"in-cubic":e=>e**3,"in-quartic":e=>e**4,"in-quintic":e=>e**5,"in-exponential":e=>1024**(e-1),"in-circular":e=>1-Math.sqrt(1-e**2),"in-elastic":(e,t,r)=>{const a=Math.max(t,1),n=getOffset(a,r);return-a*2**(10*(e-=1))*Math.sin((e-n)*pi2/r)},"out-cubic":e=>--e**3+1,"out-quartic":e=>1- --e**4,"out-quintic":e=>--e**5+1,"out-exponential":e=>1-2**(-10*e),"out-circular":e=>Math.sqrt(1- --e**2),"out-elastic":(e,t,r)=>{const a=Math.max(t,1),n=getOffset(a,r);return a*2**(-10*e)*Math.sin((e-n)*pi2/r)+1},"in-out-cubic":e=>(e*=2)<1?.5*e**3:.5*((e-=2)*e**2+2),"in-out-quartic":e=>(e*=2)<1?.5*e**4:-.5*((e-=2)*e**3-2),"in-out-quintic":e=>(e*=2)<1?.5*e**5:.5*((e-=2)*e**4+2),"in-out-exponential":e=>(e*=2)<1?.5*1024**(e-1):.5*(2-2**(-10*(e-1))),"in-out-circular":e=>(e*=2)<1?-.5*(Math.sqrt(1-e**2)-1):.5*(Math.sqrt(1-(e-=2)*e)+1),"in-out-elastic":(e,t,r)=>{const a=Math.max(t,1),n=getOffset(a,r);return(e*=2)<1?a*2**(10*(e-=1))*Math.sin((e-n)*pi2/r)*-.5:a*2**(-10*(e-=1))*Math.sin((e-n)*pi2/r)*.5+1}},decomposeEasing=e=>{const[t,r=1,a=.4]=e.trim().split(" ");return{easing:t,amplitude:r,period:a}},ease=({easing:e,amplitude:t,period:r},a)=>easings[e](a,t,r),extractRegExp=/-?\d*\.?\d+/g,extractStrings=e=>e.split(extractRegExp),extractNumbers=e=>e.match(extractRegExp).map(Number),sanitize=e=>e.map((e=>{const t=String(e);return t.startsWith("#")?rgba(t):t})),addPropertyKeyframes=(e,t)=>{const r=sanitize(t),a=first(r).split(extractRegExp);return{property:e,strings:a,numbers:r.map(extractNumbers),round:first(a).startsWith("rgb")}},createAnimationKeyframes=(e,t)=>Object.entries(e).map((([e,r])=>addPropertyKeyframes(e,computeValue(r,t)))),getCurrentValue=(e,t,r)=>e+(t-e)*r,recomposeValue=([e,t],r,a,n)=>r.reduce(((r,i,s)=>{const o=s-1,c=getCurrentValue(e[o],t[o],n);return r+(a&&s<4?Math.round(c):c)+i})),createStyles=(e,t)=>e.reduce(((e,{property:r,numbers:a,strings:n,round:i})=>(e[r]=recomposeValue(a,n,i,t),e)),{}),reverseKeyframes=e=>e.forEach((({numbers:e})=>e.reverse())),rAF={all:new Set,add(e){this.all.add(e).size<2&&requestAnimationFrame(tick)}},paused={},trackTime=(e,t)=>{e.startTime||(e.startTime=t),e.elapsed=t-e.startTime},resetTime=e=>e.startTime=0,getProgress=({elapsed:e,duration:t})=>t>0?Math.min(e/t,1):1,setSpeed=(e,t,r)=>e>0?computeValue(t,r)/e:0,addAnimations=(e,t)=>{const{elements:r=null,easing:a="out-elastic",duration:n=1e3,delay:i=0,speed:s=1,loop:o=!1,optimize:c=!1,direction:u="normal",blur:l=null,change:d=null,...m}=e,p={totalDuration:-1};getElements(r).forEach((async(e,t)=>{const r=createAnimationKeyframes(m,t),g={element:e,keyframes:r,loop:o,optimize:c,direction:u,change:d,easing:decomposeEasing(a),duration:setSpeed(s,n,t)},h=setSpeed(s,i,t),f=h+g.duration;"normal"!=u&&reverseKeyframes(r),e&&(c&&accelerate(e,r),l&&(g.blur=normalizeBlur(computeValue(l,t)),g.gaussian=blurs.add(g))),f>p.totalDuration&&(p.animation=g,p.totalDuration=f),h&&await delay(h),rAF.add(g)}));const{animation:g}=p;g&&(g.end=t,g.options=e)},tick=e=>{const{all:t}=rAF;t.forEach((r=>{trackTime(r,e);const a=getProgress(r),{element:n,keyframes:i,loop:s,optimize:o,direction:c,change:u,easing:l,duration:d,gaussian:m,end:p,options:g}=r;if(c){let e=a;switch(a){case 0:"alternate"==c&&reverseKeyframes(i);break;case 1:s?resetTime(r):(t.delete(r),o&&n&&accelerate(n),m&&clearBlur(n,m)),p&&p(g);break;default:e=ease(l,a)}return m&&setDeviation(r,e),u&&p&&u(e),void(n&&Object.assign(n.style,createStyles(i,e)))}a<1||(t.delete(r),p(d))})),t.size&&requestAnimationFrame(tick)};document.addEventListener("visibilitychange",(()=>{const e=performance.now();if(document.hidden){const{all:t}=rAF;return paused.time=e,paused.all=new Set(t),void t.clear()}const{all:t,time:r}=paused;if(!t)return;const a=e-r;requestAnimationFrame((()=>t.forEach((e=>{e.startTime+=a,rAF.add(e)}))))}));export default e=>new Promise((t=>addAnimations(e,t)));export const delay=e=>new Promise((t=>rAF.add({duration:e,end:t})));export const stop=e=>{const{all:t}=rAF,r=getElements(e);return t.forEach((e=>{r.includes(e.element)&&t.delete(e)})),r};